<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - E-Commerce Store</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      .auth-container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .auth-card {
        max-width: 450px;
        width: 100%;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
      }
      .divider {
        display: flex;
        align-items: center;
        text-align: center;
        margin: 20px 0;
      }
      .divider::before,
      .divider::after {
        content: "";
        flex: 1;
        border-bottom: 1px solid #dee2e6;
      }
      .divider span {
        padding: 0 10px;
        color: #6c757d;
        font-size: 0.875rem;
      }
      .password-toggle {
        cursor: pointer;
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
      }
      .password-wrapper {
        position: relative;
      }
      .google-btn {
        border: 1px solid #dadce0;
        background: white;
        color: #3c4043;
        font-weight: 500;
        transition: all 0.2s;
      }
      .google-btn:hover {
        background: #f8f9fa;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      .google-btn img {
        width: 20px;
        height: 20px;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="auth-container">
      <div class="auth-card card shadow-lg">
        <div class="card-body p-5">
          <!-- Logo/Header -->
          <div class="text-center mb-4">
            <i class="fas fa-shopping-bag text-danger fa-3x mb-3"></i>
            <h2 class="fw-bold">E-Commerce Store</h2>
            <p class="text-muted mb-0">
              Welcome back! Please login to continue
            </p>
          </div>

          <!-- Alert Messages -->
          <div
            id="alertMessage"
            class="alert alert-dismissible fade d-none"
            role="alert"
          >
            <span id="alertText"></span>
            <button
              type="button"
              class="btn-close"
              onclick="hideAlert()"
            ></button>
          </div>

          <!-- Login Form (Default) -->
          <div id="loginForm">
            <h5 class="mb-3 fw-bold">Sign In</h5>
            <form onsubmit="handleLogin(event)">
              <div class="mb-3">
                <label for="loginEmail" class="form-label">Email Address</label>
                <input
                  type="email"
                  class="form-control"
                  id="loginEmail"
                  placeholder="Enter your email"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="loginPassword" class="form-label">Password</label>
                <div class="password-wrapper">
                  <input
                    type="password"
                    class="form-control"
                    id="loginPassword"
                    placeholder="Enter your password"
                    required
                  />
                  <i
                    class="fas fa-eye password-toggle"
                    onclick="togglePassword('loginPassword', this)"
                  ></i>
                </div>
              </div>
              <div class="mb-3 form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="rememberMe"
                />
                <label class="form-check-label" for="rememberMe"
                  >Remember me</label
                >
              </div>
              <button
                type="submit"
                class="btn btn-danger w-100 mb-3"
                id="loginBtn"
              >
                <i class="fas fa-sign-in-alt"></i> Sign In
              </button>
            </form>

            <div class="divider">
              <span>OR</span>
            </div>

            <button
              onclick="signInWithGoogle()"
              class="google-btn btn w-100 mb-3"
            >
              <img
                src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"
                alt="Google"
              />
              Continue with Google
            </button>

            <p class="text-center text-muted mb-0">
              Don't have an account?
              <a
                href="#"
                onclick="showSignupForm(event)"
                class="text-danger fw-bold text-decoration-none"
                >Sign Up</a
              >
            </p>
          </div>

          <!-- Signup Form (Hidden by default) -->
          <div id="signupForm" class="d-none">
            <h5 class="mb-3 fw-bold">Create Account</h5>
            <form onsubmit="handleSignup(event)">
              <div class="mb-3">
                <label for="signupName" class="form-label">Full Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="signupName"
                  placeholder="Enter your full name"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="signupEmail" class="form-label"
                  >Email Address</label
                >
                <input
                  type="email"
                  class="form-control"
                  id="signupEmail"
                  placeholder="Enter your email"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="signupPassword" class="form-label">Password</label>
                <div class="password-wrapper">
                  <input
                    type="password"
                    class="form-control"
                    id="signupPassword"
                    placeholder="Create a password (min 6 characters)"
                    required
                    minlength="6"
                  />
                  <i
                    class="fas fa-eye password-toggle"
                    onclick="togglePassword('signupPassword', this)"
                  ></i>
                </div>
              </div>
              <div class="mb-3">
                <label for="signupConfirmPassword" class="form-label"
                  >Confirm Password</label
                >
                <div class="password-wrapper">
                  <input
                    type="password"
                    class="form-control"
                    id="signupConfirmPassword"
                    placeholder="Confirm your password"
                    required
                    minlength="6"
                  />
                  <i
                    class="fas fa-eye password-toggle"
                    onclick="togglePassword('signupConfirmPassword', this)"
                  ></i>
                </div>
              </div>
              <button
                type="submit"
                class="btn btn-danger w-100 mb-3"
                id="signupBtn"
              >
                <i class="fas fa-user-plus"></i> Create Account
              </button>
            </form>

            <div class="divider">
              <span>OR</span>
            </div>

            <button
              onclick="signInWithGoogle()"
              class="google-btn btn w-100 mb-3"
            >
              <img
                src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"
                alt="Google"
              />
              Continue with Google
            </button>

            <p class="text-center text-muted mb-0">
              Already have an account?
              <a
                href="#"
                onclick="showLoginForm(event)"
                class="text-danger fw-bold text-decoration-none"
                >Sign In</a
              >
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signInWithPopup,
        GoogleAuthProvider,
        updateProfile,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

      // Your Firebase configuration
      // TODO: Replace with your actual Firebase config
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDkEsScJxVCepytzyQRvd5V1jg7Ht4fqi8",
        authDomain: "shopping-commerce-5633f.firebaseapp.com",
        projectId: "shopping-commerce-5633f",
        storageBucket: "shopping-commerce-5633f.firebasestorage.app",
        messagingSenderId: "608823832201",
        appId: "1:608823832201:web:ec331a35274f8a50246058",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const googleProvider = new GoogleAuthProvider();

      // Make auth globally available
      window.auth = auth;
      window.googleProvider = googleProvider;
      window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
      window.signInWithEmailAndPassword = signInWithEmailAndPassword;
      window.signInWithPopup = signInWithPopup;
      window.updateProfile = updateProfile;

      // Check if user is already logged in
      onAuthStateChanged(auth, (user) => {
        if (user) {
          // User is signed in, redirect to store
          window.location.href = "index.html";
        }
      });
    </script>

    <script>
      // Toggle between login and signup forms
      function showSignupForm(e) {
        e.preventDefault();
        document.getElementById("loginForm").classList.add("d-none");
        document.getElementById("signupForm").classList.remove("d-none");
        hideAlert();
      }

      function showLoginForm(e) {
        e.preventDefault();
        document.getElementById("signupForm").classList.add("d-none");
        document.getElementById("loginForm").classList.remove("d-none");
        hideAlert();
      }

      // Toggle password visibility
      function togglePassword(inputId, icon) {
        const input = document.getElementById(inputId);
        if (input.type === "password") {
          input.type = "text";
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        } else {
          input.type = "password";
          icon.classList.remove("fa-eye-slash");
          icon.classList.add("fa-eye");
        }
      }

      // Show alert message
      function showAlert(message, type = "danger") {
        const alertDiv = document.getElementById("alertMessage");
        const alertText = document.getElementById("alertText");
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertText.innerHTML = `<i class="fas fa-${
          type === "success" ? "check-circle" : "exclamation-circle"
        }"></i> ${message}`;
      }

      function hideAlert() {
        const alertDiv = document.getElementById("alertMessage");
        alertDiv.className = "alert alert-dismissible fade d-none";
      }

      // Handle Login
      async function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;
        const loginBtn = document.getElementById("loginBtn");

        loginBtn.disabled = true;
        loginBtn.innerHTML =
          '<span class="spinner-border spinner-border-sm me-2"></span>Signing In...';

        try {
          const userCredential = await window.signInWithEmailAndPassword(
            window.auth,
            email,
            password
          );
          showAlert("Login successful! Redirecting...", "success");

          // Store user info
          localStorage.setItem("userEmail", userCredential.user.email);
          localStorage.setItem(
            "userName",
            userCredential.user.displayName || "User"
          );

          setTimeout(() => {
            window.location.href = "index.html";
          }, 1500);
        } catch (error) {
          let errorMessage = "Login failed. Please try again.";

          switch (error.code) {
            case "auth/user-not-found":
              errorMessage = "No account found with this email.";
              break;
            case "auth/wrong-password":
              errorMessage = "Incorrect password. Please try again.";
              break;
            case "auth/invalid-email":
              errorMessage = "Invalid email address.";
              break;
            case "auth/too-many-requests":
              errorMessage =
                "Too many failed attempts. Please try again later.";
              break;
          }

          showAlert(errorMessage, "danger");
          loginBtn.disabled = false;
          loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
        }
      }

      // Handle Signup
      async function handleSignup(e) {
        e.preventDefault();
        const name = document.getElementById("signupName").value;
        const email = document.getElementById("signupEmail").value;
        const password = document.getElementById("signupPassword").value;
        const confirmPassword = document.getElementById(
          "signupConfirmPassword"
        ).value;
        const signupBtn = document.getElementById("signupBtn");

        // Validate passwords match
        if (password !== confirmPassword) {
          showAlert("Passwords do not match!", "danger");
          return;
        }

        signupBtn.disabled = true;
        signupBtn.innerHTML =
          '<span class="spinner-border spinner-border-sm me-2"></span>Creating Account...';

        try {
          const userCredential = await window.createUserWithEmailAndPassword(
            window.auth,
            email,
            password
          );

          // Update user profile with name
          await window.updateProfile(userCredential.user, {
            displayName: name,
          });

          showAlert("Account created successfully! Redirecting...", "success");

          // Store user info
          localStorage.setItem("userEmail", email);
          localStorage.setItem("userName", name);

          setTimeout(() => {
            window.location.href = "index.html";
          }, 1500);
        } catch (error) {
          let errorMessage = "Signup failed. Please try again.";

          switch (error.code) {
            case "auth/email-already-in-use":
              errorMessage =
                "This email is already registered. Please sign in.";
              break;
            case "auth/invalid-email":
              errorMessage = "Invalid email address.";
              break;
            case "auth/weak-password":
              errorMessage = "Password should be at least 6 characters.";
              break;
          }

          showAlert(errorMessage, "danger");
          signupBtn.disabled = false;
          signupBtn.innerHTML =
            '<i class="fas fa-user-plus"></i> Create Account';
        }
      }

      // Sign in with Google
      async function signInWithGoogle() {
        try {
          const result = await window.signInWithPopup(
            window.auth,
            window.googleProvider
          );
          showAlert(
            "Signed in with Google successfully! Redirecting...",
            "success"
          );

          // Store user info
          localStorage.setItem("userEmail", result.user.email);
          localStorage.setItem("userName", result.user.displayName || "User");

          setTimeout(() => {
            window.location.href = "index.html";
          }, 1500);
        } catch (error) {
          let errorMessage = "Google sign-in failed.";

          if (error.code === "auth/popup-closed-by-user") {
            errorMessage = "Sign-in popup was closed.";
          }

          showAlert(errorMessage, "danger");
        }
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
